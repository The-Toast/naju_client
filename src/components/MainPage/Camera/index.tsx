'use client'

import { useEffect, useState } from 'react'

import { QrCodeIcon } from '@phosphor-icons/react'

import QrScanner from './QrScanner'

export default function Camera() {
  const [isFadingOut, setIsFadingOut] = useState(false)
  const [hideTip, setHideTip] = useState(false)
  const [isOpen, setIsOpen] = useState(false)

  const handleScanResultAction = (text: string) => {
    console.log('스캔된 내용:', text)
    setIsOpen(false)
  }

  const handleCloseAction = () => {
    setIsOpen(false)
  }

  useEffect(() => {
    const fadeTimer = setTimeout(() => {
      setIsFadingOut(true)
    }, 10000)

    const removeTimer = setTimeout(() => {
      setHideTip(true)
    }, 10500)

    return () => {
      clearTimeout(fadeTimer)
      clearTimeout(removeTimer)
    }
  }, [])
  return (
    <>
      <Container>
        {
          !hideTip &&
            <ToolTip isFadingOut={isFadingOut}>
                <svg width="211" height="30" viewBox="0 0 211 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0 4C0 1.79086 1.79086 0 4 0H201C203.209 0 205 1.79086 205 4V26C205 28.2091 203.209 30 201 30H4C1.79086 30 0 28.2091 0 26V4Z" fill="#FB57A0"/>
                    <path d="M16.3004 16.3398H17.4488L18.3512 17.5117C18.984 16.9609 19.3824 16.0293 19.3824 14.7578C19.3824 12.5664 18.1871 11.3828 16.652 11.3828C15.1168 11.3828 13.9215 12.5664 13.9215 14.7578C13.9215 16.9492 15.1168 18.1328 16.652 18.1328C16.9684 18.1328 17.273 18.0801 17.5543 17.9805L16.3004 16.3398ZM20.402 14.7578C20.402 16.3398 19.8512 17.5762 18.9605 18.3203L20.0621 19.7969H18.9137L18.1754 18.8008C17.7125 19.0117 17.2027 19.1172 16.652 19.1172C14.4723 19.1172 12.902 17.4414 12.902 14.7578C12.902 12.0742 14.4723 10.3984 16.652 10.3984C18.8199 10.3984 20.402 12.0742 20.402 14.7578ZM21.6488 19V10.5156H24.5316C26.5238 10.5156 27.4262 11.6172 27.4262 13.1289C27.4262 14.248 26.9223 15.1328 25.8441 15.5078L27.7543 19H26.5238L24.7543 15.6953L24.5434 15.707H22.7035V19H21.6488ZM22.7035 14.7461H24.4965C25.8441 14.7461 26.3832 14.1367 26.3832 13.1289C26.3832 12.1094 25.8441 11.4531 24.4848 11.4531H22.7035V14.7461ZM39.1777 10.5508V11.5586C39.166 12.8242 39.1777 14.2539 38.7441 16.375L37.8418 16.2695C38.0469 15.3262 38.1523 14.5 38.2168 13.7617L31.8418 14.1484L31.6895 13.3398L38.252 13.0703C38.2754 12.5195 38.2754 12.0215 38.2754 11.5586V11.3125H31.9941V10.5508H39.1777ZM40.3379 17.7461V18.5312H30.8457V17.7461H34.5723V15.0508H35.4746V17.7461H40.3379ZM49.3309 14.5469V15.3086H42.1355V10.5039H49.2254V11.2656H43.0496V14.5469H49.3309ZM50.4559 17.7578V18.5312H40.9168V17.7578H50.4559ZM60.5152 14.3711V15.0977H50.9762V14.3711H60.5152ZM59.3199 15.9297V18.1445H53.0621V19.1406H59.6598V19.8086H52.1363V17.5117H58.4059V16.6211H52.1246V15.9297H59.3199ZM59.2848 9.84766V12.0039H53.1324V12.918H59.4723V13.5859H52.2184V11.3711H58.359V10.5156H52.1832V9.84766H59.2848ZM72.4777 16.3047V19.9492H71.5637V17.0547H65.3293V16.3047H72.4777ZM72.4777 9.53125V15.7773H71.5637V9.53125H72.4777ZM66.2551 11.6523C66.2551 12.4023 66.5012 13.5977 67.3332 14.3828C68.1418 13.627 68.3879 12.4609 68.3879 11.6523V11.0898H67.591V10.3281H70.5559V11.0898H69.2785V11.6523C69.2668 12.6602 69.759 14.0195 70.9543 14.6406L70.4621 15.3086C69.6301 14.8633 69.1203 14.0898 68.8449 13.2461C68.6164 14.0957 68.1594 14.9277 67.3332 15.4023C66.5129 14.9219 66.0559 14.0957 65.8215 13.2578C65.5461 14.0898 65.0363 14.8633 64.216 15.3086L63.7004 14.6406C64.8957 13.9961 65.3996 12.625 65.3996 11.6523V11.0898H64.0754V10.3281H67.0754V11.0898H66.2551V11.6523ZM78.5879 10.2109C80.7676 10.2109 82.3965 11.3477 82.3965 13.0703C82.3965 14.8047 80.7676 15.9414 78.5879 15.9297C76.4082 15.9414 74.7793 14.8047 74.7793 13.0703C74.7793 11.3477 76.4082 10.2109 78.5879 10.2109ZM78.5879 10.9609C76.9121 10.9492 75.6465 11.8281 75.6582 13.0703C75.6465 14.3359 76.9121 15.1797 78.5879 15.1797C80.252 15.1797 81.5059 14.3359 81.5059 13.0703C81.5059 11.8281 80.252 10.9492 78.5879 10.9609ZM83.3809 17.793V18.5664H73.8418V17.793H83.3809ZM92.5379 9.53125V19.9727H91.6238V15.5312H89.4559V14.7578H91.6238V12.6836H89.5379V11.9102H91.6238V9.53125H92.5379ZM88.8582 10.4805V14.1836H85.2254V16.75C86.7898 16.7441 88.0848 16.6855 89.6668 16.4453L89.7488 17.2188C88.0848 17.4766 86.7488 17.5352 85.0848 17.5352H84.3113V13.4336H87.9559V11.2422H84.2762V10.4805H88.8582ZM99.2574 10.4453V11.3711H101.695V9.54297H102.621V17.1484H101.695V14.3711H99.2574V15.3086H94.4762V10.4453H99.2574ZM95.3902 11.207V14.5703H98.3551V11.207H95.3902ZM102.855 18.9531V19.7266H95.8824V16.4688H96.8082V18.9531H102.855ZM99.2574 13.6094H101.695V12.1445H99.2574V13.6094ZM115.404 9.53125V19.9727H114.489V14.1719H111.993V17.3359H107.189V10.3516H108.114V13.0703H111.091V10.3516H111.993V13.4102H114.489V9.53125H115.404ZM108.114 16.5742H111.091V13.8086H108.114V16.5742ZM126.33 15.3086V16.0586H116.826V15.3086H126.33ZM125.334 18.9531V19.7266H118.068V16.8203H118.982V18.9531H125.334ZM125.205 13.5977V14.3242H118.092V9.92969H125.146V10.668H119.018V11.7578H124.865V12.4727H119.018V13.5977H125.205ZM131.655 9.71875C133.975 9.71875 135.335 10.3516 135.335 11.5117C135.335 12.6953 133.975 13.3281 131.655 13.3398C129.335 13.3281 127.964 12.6953 127.964 11.5117C127.964 10.3516 129.335 9.71875 131.655 9.71875ZM131.655 10.4102C129.921 10.4102 128.913 10.832 128.925 11.5117C128.913 12.2383 129.921 12.6367 131.655 12.6367C133.378 12.6367 134.397 12.2383 134.397 11.5117C134.397 10.832 133.378 10.4102 131.655 10.4102ZM136.401 14.043V14.793H126.909V14.043H136.401ZM135.182 15.6953V18.0273H128.995V19.1055H135.499V19.832H128.081V17.3477H134.28V16.3984H128.057V15.6953H135.182ZM148.094 12.0391V12.8008H140.981V9.70703H141.883V12.0391H148.094ZM149.219 13.7148V14.4648H144.871V15.5781H147.989V17.957H141.825V19.0938H148.364V19.832H140.899V17.2891H147.086V16.293H140.875V15.5781H143.981V14.4648H139.68V13.7148H149.219ZM158.388 9.53125V19.9727H157.474V14.3125H155.446V13.5391H157.474V9.53125H158.388ZM154.814 10.5039V14.1484H151.075V16.6797C152.868 16.6797 154.169 16.627 155.693 16.3398L155.763 17.1133C154.193 17.3945 152.845 17.4531 150.958 17.4648H150.161V13.3867H153.923V11.2656H150.126V10.5039H154.814ZM165.096 11.0078C165.084 12.4023 166.947 13.5859 168.764 13.8555L168.424 14.582C166.795 14.3066 165.213 13.4395 164.58 12.1797C163.947 13.4395 162.359 14.3066 160.76 14.582L160.396 13.8555C162.201 13.5859 164.064 12.4023 164.064 11.0078V10.9375H160.725V10.1875H168.424V10.9375H165.096V11.0078ZM169.326 15.4727V16.2344H165.014V19.9492H164.111V16.2344H159.834V15.4727H169.326ZM172.999 12.4961C172.999 14.1484 173.807 15.9414 175.19 16.7617L174.663 17.4766C173.661 16.8672 172.94 15.7539 172.577 14.4883C172.19 15.8711 171.417 17.0605 170.374 17.6992L169.788 17.0078C171.229 16.1641 172.108 14.3125 172.108 12.5312V10.5156H172.999V12.4961ZM178.835 9.53125V19.9492H177.944V9.53125H178.835ZM176.679 9.75391V19.4219H175.811V14.0547H174.042V13.2695H175.811V9.75391H176.679ZM189.515 17.8398V18.6133H179.976V17.8398H182.343V15.0273C181.453 14.5645 180.914 13.8145 180.914 12.8711C180.914 11.2539 182.496 10.1992 184.722 10.1875C186.949 10.1992 188.531 11.2539 188.531 12.8711C188.531 13.7969 188.009 14.541 187.148 15.0039V17.8398H189.515ZM184.722 10.9492C183.011 10.9375 181.804 11.7109 181.804 12.8711C181.804 14.0312 183.011 14.8164 184.722 14.8164C186.421 14.8164 187.64 14.0312 187.64 12.8711C187.64 11.7109 186.421 10.9375 184.722 10.9492ZM183.246 17.8398H186.222V15.3555C185.771 15.4785 185.267 15.543 184.722 15.543C184.189 15.543 183.691 15.4844 183.246 15.3672V17.8398ZM191.735 10.5156L191.653 16.6094H190.668L190.586 10.5156H191.735ZM191.161 19.0703C190.75 19.0703 190.399 18.7305 190.411 18.3086C190.399 17.8984 190.75 17.5586 191.161 17.5586C191.571 17.5586 191.911 17.8984 191.911 18.3086C191.911 18.7305 191.571 19.0703 191.161 19.0703Z" fill="white"/>
                    <path d="M211 15.0002C211 16 209.333 17.6637 208 19.1571C206.925 20.3611 205 21.9998 205 21.9998V8C205 8 206.925 9.63907 208 10.8433C209.333 12.3368 211 14.0005 211 15.0002Z" fill="#FB57A0"/>
                </svg>
            </ToolTip>
        }
        <Content onClick={() => setIsOpen(true)}>
          <QrCodeIcon size={28} style={{ opacity: 0.6 }} />
        </Content>
      </Container>
      {isOpen && (
        <QrScanner
          onScanResultAction={handleScanResultAction}
          onCloseAction={handleCloseAction}
        />
      )}
    </>
  )
}

import styled from '@emotion/styled'
import { keyframes } from '@emotion/react'

const pulse = keyframes`
  0% { gap: 1.5rem; }
  50% { gap: 1rem; }
  100% { gap: 1.5rem; }
`

export const Container = styled.div`
  // Layout
  display: flex;
  position: fixed;
  bottom: 0;
  right: 0;
  padding: 1.25rem;
  margin-bottom: 5.75rem;

  // Animation
  animation: ${pulse} 1.2s ease-in-out infinite;
`

export const ToolTip = styled.div<{ isFadingOut: boolean }>`
  // Layout
  display: flex;
  align-items: center;
  
  opacity: ${({ isFadingOut }) => (isFadingOut ? 0 : 1)};
  transition: opacity 0.5s ease-in-out;
`

export const Content = styled.div`
  // Layout
  display: inline-flex;
  padding: 1rem;
  align-items: center;
  gap: 0.625rem;
  
  // Typography
  border-radius: 5rem;
  background: ${({ theme }) => theme.Background.BG4};
`